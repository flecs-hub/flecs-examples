using flecs.script.*
using flecs.components.*

template FencePost {
  prop x: 0.0
  Position3: {x, 1}
  Box: {0.5, 2, 0.5}
}

template FenceBoard {
  prop width: 10.0
  prop y: 1.0
  Position3: {0, y}
  Box: {width, 0.5, 0.2}
}

template Fence {
  prop width: 10.0
  const post_count = i32: 2 + width / 5
  const post_spacing: width / (post_count - 1)
  
  with Rgb(0.15, 0.1, 0.05) {
    for i in 0..post_count {
      FencePost(i * post_spacing - width / 2)
    }
    
    FenceBoard(width, 0.5)
    FenceBoard(width, 1.5)
  }
}

template Enclosing {
  prop width: 10.0
  prop depth: 10.0
  
  {
    Position3: {}
    Rgb: {0.05, 0.2, 0.02}
    Box: {width, 0.1, depth}
  }
  
  Fence(width) { Position3: {z: 0.5 * -depth} }
  Fence(width) { Position3: {z: 0.5 * depth} }

  with Rotation3(y: PI / 2) {
    Fence(depth) { Position3: {x: 0.5 * -width} }
    Fence(depth) { Position3: {x: 0.5 * width} }
  }
}

Enclosing my_pen(width: 10, depth: 15) {
  Position3: {y: -2, z: 5}
}
